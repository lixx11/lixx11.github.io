<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">

    <title>Click-Doc | LCLS Tutorial </title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    

    <!-- fonts -->
    <link href="//fonts.googleapis.com/css?family=Source+Sans+Pro:400,700" rel="stylesheet">
    <link href="//fonts.googleapis.com/css?family=Ubuntu:300,400,500,600,700" rel="stylesheet">

    <!-- stylesheets -->
    <link rel="stylesheet" href="/Click/style/doc.css">

    <!-- favicon -->
    <link rel="icon" href="/Click/images/favicon.ico">

    

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-128191230-1"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-128191230-1');
    </script><!-- hexo-inject:begin --><!-- hexo-inject:end -->



  </head>
  <body>

   <!-- hexo-inject:begin --><!-- hexo-inject:end --><script>window.__INITIAL_STATE__ = {"page":{"title":"LCLS Tutorial","path":"LCLS-tutorial.html"},"data":{"navigation":{"logo":{"text":"Click","type":"link","path":"index.html"},"main":[{"text":"Overview","type":"link","path":"index.html"},{"text":"Get Started","type":"link","path":"get-started.html"},{"text":"Modules","type":"link","path":"modules.html","children":[{"text":"Main Window","type":"link","path":"main-win.html"},{"text":"Batch Window","type":"link","path":"job-win.html"},{"text":"Calibration Window","type":"link","path":"powder-win.html"}]},{"text":"Algorithms","type":"label","children":[{"text":"Hit Finding","type":"link","path":"hit-finding-alg.html"},{"text":"Powder Fit","type":"link","path":"powder-fit-alg.html"}]},{"text":"Tutorial","type":"link","path":"tutorial.html","children":[{"text":"PAL-XFEL","type":"link","path":"PAL-tutorial.html"},{"text":"LCLS","type":"link","path":"LCLS-tutorial.html"}]}]}},"config":{"timezone":"CN","root":"/Click/","time_format":"HH:mm:ss","theme":"../node_modules/hexo-theme-doc","theme_config":{"swagger_ui":{"version":2,"permalinks":true,"api_explorer":true,"download":"Download specification","show_extensions":false,"deep_linking":true,"display_operation_id":false,"doc_expansion":"none"},"search":{"skip":false,"background":false,"route":"/lunr.json"},"favicon":"images/favicon.ico"}}}</script>

    <div id="react-navigation-root"><div class="doc-navigation" data-reactroot=""><nav class="doc-navbar"><a href="/Click/index.html" class="doc-navbar__logo"><img src="/Click/images/logo.png" class="doc-navbar__logo__img"/><span class="doc-navbar__logo__text">Click</span></a><i class="dc-icon dc-icon--close dc-icon--interactive doc-sidebar-close doc-navbar__sidebar-close doc-navbar__sidebar-close--desktop"></i><i class="dc-icon dc-icon--menu dc-icon--interactive doc-sidebar-toggle doc-navbar__sidebar-toggle"></i></nav><nav class="doc-sidebar"><div class="doc-sidebar__vertical-menu"><i class="dc-icon dc-icon--menu dc-icon--interactive doc-sidebar-toggle doc-sidebar-toggle--primary doc-sidebar__vertical-menu__item"></i><i class="dc-icon dc-icon--search dc-icon--interactive doc-sidebar__vertical-menu__item doc-sidebar__vertical-menu__item--primary"></i></div><div class="doc-sidebar-content"><div class="doc-sidebar__search-form"></div><ul class="doc-sidebar-list"></ul></div></nav></div></div>
    <div class="doc-content">
  <div class="dc-page">
    <div class="dc-card">
      <div id="react-search-results-root"></div>
      <div id="page-content" class="doc-formatting">
        <h1 id="LCLS-Tutorial"><a href="#LCLS-Tutorial" class="headerlink" title="LCLS Tutorial"></a>LCLS Tutorial</h1><h2 id="Environment-Setup"><a href="#Environment-Setup" class="headerlink" title="Environment Setup"></a>Environment Setup</h2><p>LCLS stores raw data in <strong>XTC</strong> format, which we could not read directly like hdf5 or numpy files, so we use <strong>psana</strong> API to read raw data. Users need setup enviroment before running <strong>Click</strong> every time.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> /reg/g/psdm/etc/psconda.sh  <span class="comment"># setup psana environment</span></span><br><span class="line"><span class="built_in">export</span> PATH=/path/to/your/anaconda2/bin:<span class="variable">$PATH</span>  <span class="comment"># setup your conda</span></span><br><span class="line">LD_LIBRARY_PATH=/path/to/your/anaconda2/lib:<span class="variable">$LD_LIBRARY_PATH</span></span><br><span class="line"><span class="built_in">unset</span> PYTHONPATH</span><br><span class="line"><span class="built_in">export</span> facility=LCLS  <span class="comment"># tell Click your facility</span></span><br></pre></td></tr></table></figure>
<h2 id="Project-Setup"><a href="#Project-Setup" class="headerlink" title="Project Setup"></a>Project Setup</h2><p>After you setup your environment, create a Click project by:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python /path/to/Click/gui.py startproject project_name -f LCLS</span><br></pre></td></tr></table></figure>
<p>Click will create a folder with the name of <em>project_name</em> and setup all configurations and subfolders. Look at what Click created:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">project_name</span><br><span class="line">├── conf</span><br><span class="line">│   ├── hit_finding  <span class="comment"># hit finding configuration files</span></span><br><span class="line">│   └── indexing  <span class="comment"># indexing configuration files, not implemented yet</span></span><br><span class="line">├── cxi_comp  <span class="comment"># compressed raw data</span></span><br><span class="line">├── cxi_hit  <span class="comment"># hits data</span></span><br><span class="line">|—— geom <span class="comment"># geometry file to convert raw data into assembled data</span></span><br><span class="line">|   └—— sep-2018.geom  <span class="comment"># default geom </span></span><br><span class="line">├── indexing  <span class="comment"># perform indexing here</span></span><br><span class="line">├── mask  <span class="comment"># mask files</span></span><br><span class="line">│   ├── cspad-edges.npy  <span class="comment"># mask of edges of cspad detector</span></span><br><span class="line">│   └── dead-pixels.npy  <span class="comment"># mask of edges and unbound pixels, generated by xxli</span></span><br><span class="line">├── mean  <span class="comment"># mean/sigma files</span></span><br><span class="line">├── powder  <span class="comment"># peak powder files</span></span><br><span class="line">|── raw_lst  <span class="comment"># list file used in batch job system</span></span><br><span class="line">└── xtc_proxy  <span class="comment"># proxy data for LCLS</span></span><br></pre></td></tr></table></figure>
<p>Start analysis with Click.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> project_name</span><br><span class="line">python /path/to/Click/gui.py</span><br></pre></td></tr></table></figure>
<h2 id="Create-Proxy-Data"><a href="#Create-Proxy-Data" class="headerlink" title="Create Proxy Data"></a>Create Proxy Data</h2><p>To read raw data with <strong>psana</strong> API, a proxy model is implemented. Users need create proxy data before analysis. Just click <strong>File -&gt; Create Proxy Data(LCLS)</strong>, then input the experiment id, detector name and other parameters in the popup dialog, click <strong>Apply</strong> to create those files.</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/TFJHTaG0_p0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

<p>If you don’t know your experiment id, check <a href="https://pswww.slac.stanford.edu" target="_blank" rel="noopener">LCLS Contral &amp; Data System</a> or ask beamline scientist.</p>
<p>For detector name, you can use <a href="https://confluence.slac.stanford.edu/display/PSDM/Detector+Names+in+an+Event" target="_blank" rel="noopener">detnames</a> tool:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> /reg/g/psdm/etc/psconda.sh</span><br><span class="line">detnames exp=your_exp:run=run_numb</span><br><span class="line"></span><br><span class="line"><span class="comment"># output example</span></span><br><span class="line">---------------------------------------------------</span><br><span class="line">Full Name                 | DAQ Alias  | User Alias</span><br><span class="line">---------------------------------------------------</span><br><span class="line">CxiEndstation.0:Acqiris.0 | Acqiris    |           </span><br><span class="line">NoDetector.0:Evr.1        | evr1       |           </span><br><span class="line">CxiSc1.0:Opal1000.0       | Sc1OffAxis |           </span><br><span class="line">CxiDs1.0:Cspad.0          | DscCsPad   |           </span><br><span class="line">CxiDsu.0:Opal1000.0       | Timetool   |           </span><br><span class="line">ControlData               |            |           </span><br><span class="line">---------------------------------------------------</span><br></pre></td></tr></table></figure>
<p>If you are working on a pump-probe experiment, you can check the <strong>event codes</strong> to collect the pump information for further analysis.</p>

        <div id="react-support-footer-root"></div>
      </div>
    </div>
  </div>
</div>

    


    

    <!-- js vendors -->
    <script src="//code.jquery.com/jquery-3.2.1.min.js" crossorigin="anonymous"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/lunr.js/2.1.0/lunr.min.js"></script>

    <!-- js source  -->
    <script src="/Click/script/doc.js"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->

    

  </body>
</html>
